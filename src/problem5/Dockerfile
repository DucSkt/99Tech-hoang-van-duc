# ğŸ— 1. Sá»­ dá»¥ng Node.js LTS phiÃªn báº£n nháº¹
FROM node:18-alpine AS builder

# ğŸ“‚ 2. Set thÆ° má»¥c lÃ m viá»‡c
WORKDIR /app

# ğŸ“¦ 3. Copy package.json vÃ  package-lock.json trÆ°á»›c Ä‘á»ƒ táº­n dá»¥ng cache
COPY package.json package-lock.json ./
RUN npm install

# ğŸš€ 4. Copy toÃ n bá»™ code vÃ  build TypeScript
COPY . .
RUN npm run build  # Cháº¡y build Ä‘á»ƒ táº¡o thÆ° má»¥c dist/

# ğŸ— 5. Production stage (cháº¡y app)
FROM node:18-alpine AS production

# ğŸ“‚ 6. Set thÆ° má»¥c lÃ m viá»‡c
WORKDIR /app

# ğŸ“¦ 7. Copy dependencies tá»« builder nhÆ°ng chá»‰ giá»¯ production dependencies
COPY package.json package-lock.json ./
RUN npm install --only=production

# ğŸš€ 8. Copy dist/ tá»« builder
COPY --from=builder /app/dist ./dist

# âš™ï¸ 9. Expose cá»•ng cháº¡y á»©ng dá»¥ng
EXPOSE 3000

# ğŸ 10. Cháº¡y á»©ng dá»¥ng
CMD ["node", "dist/server.js"]
